{"version":3,"file":"index.mjs","sources":["../../libs/timer/index.ts"],"sourcesContent":["import { type Ref, ref } from '@vue/reactivity'\r\n\r\nexport interface TimeoutApi {\r\n  resolve: Ref<() => void>\r\n  reject: Ref<(error: Error) => void>\r\n  reset: (ms?: number) => void\r\n  promise: Promise<void>\r\n  // Add other properties as needed\r\n}\r\n\r\nexport function createTimeout(timeoutMs: number, timeoutError = new Error('timeout!')): TimeoutApi {\r\n  let timeout: undefined | null | ReturnType<typeof setTimeout> = undefined\r\n  let resolve = ref(() => {\r\n    if (!timeout) {\r\n      timeout = null\r\n      return\r\n    }\r\n    clearTimeout(timeout!)\r\n    timeout = null\r\n  })\r\n  let reject = ref((_: Error) => {})\r\n  const reset = (ms: number = timeoutMs) => {\r\n    if (!timeout) {\r\n      return\r\n    }\r\n    clearTimeout(timeout)\r\n    timeout = setTimeout(() => {\r\n      reject.value(timeoutError)\r\n    }, ms)\r\n    timeoutMs = ms\r\n  }\r\n  let promise = new Promise<void>((innerResolve, innerReject) => {\r\n    if (timeout === null) {\r\n      innerResolve()\r\n      return\r\n    }\r\n    timeout = setTimeout(() => {\r\n      innerReject(timeoutError)\r\n    }, timeoutMs)\r\n    resolve.value = () => {\r\n      innerResolve()\r\n      clearTimeout(timeout!)\r\n      timeout = null\r\n    }\r\n    reject.value = () => {\r\n      innerReject(timeoutError)\r\n    }\r\n  })\r\n  const api: TimeoutApi = {\r\n    resolve,\r\n    reject,\r\n    reset,\r\n    promise,\r\n  }\r\n  return api\r\n}\r\n"],"names":["createTimeout","timeoutMs","timeoutError","timeout","resolve","ref","reject","_","reset","ms","promise","innerResolve","innerReject"],"mappings":";AAUO,SAASA,EAAcC,GAAmBC,IAAe,IAAI,MAAM,UAAU,GAAe;AACjG,MAAIC,GACAC,IAAUC,EAAI,MAAM;AACtB,QAAI,CAACF,GAAS;AACF,MAAAA,IAAA;AACV;AAAA,IACF;AACA,iBAAaA,CAAQ,GACXA,IAAA;AAAA,EAAA,CACX,GACGG,IAASD,EAAI,CAACE,MAAa;AAAA,EAAA,CAAE;AAC3B,QAAAC,IAAQ,CAACC,IAAaR,MAAc;AACxC,IAAKE,MAGL,aAAaA,CAAO,GACpBA,IAAU,WAAW,MAAM;AACzB,MAAAG,EAAO,MAAMJ,CAAY;AAAA,OACxBO,CAAE,GACOR,IAAAQ;AAAA,EAAA;AAEd,MAAIC,IAAU,IAAI,QAAc,CAACC,GAAcC,MAAgB;AAC7D,QAAIT,MAAY,MAAM;AACP,MAAAQ;AACb;AAAA,IACF;AACA,IAAAR,IAAU,WAAW,MAAM;AACzB,MAAAS,EAAYV,CAAY;AAAA,OACvBD,CAAS,GACZG,EAAQ,QAAQ,MAAM;AACP,MAAAO,KACb,aAAaR,CAAQ,GACXA,IAAA;AAAA,IAAA,GAEZG,EAAO,QAAQ,MAAM;AACnB,MAAAM,EAAYV,CAAY;AAAA,IAAA;AAAA,EAC1B,CACD;AAOM,SANiB;AAAA,IACtB,SAAAE;AAAA,IACA,QAAAE;AAAA,IACA,OAAAE;AAAA,IACA,SAAAE;AAAA,EAAA;AAGJ;"}